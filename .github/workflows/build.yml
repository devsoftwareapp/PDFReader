name: Build Android APK

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install Capacitor project
        run: |
          mkdir app
          cd app
          
          # package.json oluştur
          cat << 'EOF' > package.json
          {
            "name": "pdfapp",
            "version": "1.0.0",
            "private": true,
            "scripts": {
              "build": "echo 'skip'",
              "sync": "npx cap sync"
            },
            "dependencies": {
              "@capacitor/android": "6.1.0",
              "@capacitor/core": "6.1.0"
            }
          }
          EOF

          # capacitor.config.ts oluştur
          cat << 'EOF' > capacitor.config.ts
          import { CapacitorConfig } from '@capacitor/core';
          const config: CapacitorConfig = {
            appId: 'com.dev.pdf',
            appName: 'PDF Reader',
            webDir: 'web'
          };
          export default config;
          EOF

          mkdir web
          cp -r ../web/* ./web/

          npm install
          npx cap add android

      - name: Build Android
        run: |
          cd app/android
          ./gradlew assembleDebug

      - name: Upload Debug APK
        uses: actions/upload-artifact@v4
        with:
          name: debug-apk
          path: app/android/app/build/outputs/apk/debug/*.apk
